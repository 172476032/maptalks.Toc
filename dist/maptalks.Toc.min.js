/*!
 * maptalks.Toc v0.1.2
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@^0.16.0 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,t){"use strict";function a(e,t){for(var a=Object.getOwnPropertyNames(t),i=0;i<a.length;i++){var o=a[i],r=Object.getOwnPropertyDescriptor(t,o);r&&r.configurable&&void 0===e[o]&&Object.defineProperty(e,o,r)}return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):a(e,t))}var s={position:{top:"100",left:"200"},draggable:!0,styles:{width:"800",height:"800"}},n=function(e){function a(t){i(this,a);var r=o(this,e.call(this));return r.options=t,r}return r(a,e),a.prototype.buildOn=function(e){for(var a=t.DomUtil.createEl("div","maptalks-Toc"),i=t.DomUtil.createEl("ul","maptalks-layerUl"),o="",r=this._getLayerIds(e),s=r.length-1;s>=0;s--){var n=void 0;1==r[s].visible?(n="checked",o=o+'<li class="maptalks-layerLi" id="'+r[s].id+'"><input class="maptalks-layerInput" id="'+r[s].id+'" type="checkbox"  checked="'+n+'"><p class="maptalks-layerName">'+r[s].id+"</p></li>"):o=o+'<li class="maptalks-layerLi" id="'+r[s].id+'"><input class="maptalks-layerInput" id="'+r[s].id+'" type="checkbox" ><p class="maptalks-layerName">'+r[s].id+"</p></li>"}return i.innerHTML=o,this._setstyle(a,this.options),a.appendChild(i),this._domToc=a,e.on("addlayer",this._addLayers,this),this._layerDomMousedown(this._domToc),this._registerDomEvent(),a},a.prototype._addLayers=function(e){for(var a="",i=this._getLayerIds(map),o=i.length-1;o>=0;o--){var r=void 0;1==i[o].visible?(r="checked",a=a+'<li class="maptalks-layerLi" id="'+i[o].id+'"><input class="maptalks-layerInput" id="'+i[o].id+'" type="checkbox"  checked="'+r+'"><p class="maptalks-layerName">'+i[o].id+"</p></li>"):a=a+'<li class="maptalks-layerLi" id="'+i[o].id+'"><input class="maptalks-layerInput" id="'+i[o].id+'" type="checkbox" ><p class="maptalks-layerName">'+i[o].id+"</p></li>"}var s=t.DomUtil.createEl("newUl","maptalks-layerNewUl");s.innerHTML=a;var n=document.getElementsByClassName("maptalks-layerUl")[0];document.getElementsByClassName("maptalks-Toc")[0].replaceChild(s,n)},a.prototype._getLayerIds=function(e){for(var t=[],a=e.getLayers(),i=0;i<a.length;i++){var o={};o.id=a[i].getId(),o.visible=a[i].isVisible(),o.zindex=a[i].getZIndex(),t.push(o)}var r={};return r.id=e.getBaseLayer().getId(),r.visible=e.getBaseLayer().isVisible(),r.zindex=e.getBaseLayer().getZIndex(),t.push(r),t=this._layerZindexSort(t,"zindex"),console.log(t),t},a.prototype._layerZindexSort=function(e,t){return e=e.sort(this._layerZindexCompare(t))},a.prototype._layerZindexCompare=function(e){return function(t,a){return t[e]-a[e]}},a.prototype._switchLayer=function(){this.map=this.getMap();var e=document.getElementsByClassName("maptalks-layerInput");if(e.length>0)for(var t=0;t<e.length;t++)e[t].onclick=function(e){var t=e.target.id;e.target.checked?this.map.getLayer(t)?this.map.getLayer(t).show():this.map.getBaseLayer().show():this.map.getLayer(t)?this.map.getLayer(t).hide():this.map.getBaseLayer().hide()}.bind(this);else alert("No Layers")},a.prototype._registerDomEvent=function(){this._domToc&&t.DomUtil.addDomEvent(this._domToc,"mouseover",this._switchLayer,this)},a.prototype._setstyle=function(e,t){for(var a in t.styles)e.style[a]=t.styles[a]},a.prototype._layerDomMousedown=function(e){for(var t=document.getElementsByTagName("maptalks-layerLi"),a=void 0,i=0;i<t.length;i++)t[i].onmousedown=function(e){a=e.target.id},t[i].onmouseup=function(t){var i=t.target.id,o=document.getElementById(a),r=document.getElementById(i);e.insertBefore(o,r)}},a}(t.control.Control);n.mergeOptions(s),e.Toc=n,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.Toc v0.1.2, requires maptalks@^0.16.0.")});