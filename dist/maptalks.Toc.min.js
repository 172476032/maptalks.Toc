/*!
 * maptalks.Toc v0.1.2
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@^0.16.0 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,t){"use strict";function a(e,t){for(var a=Object.getOwnPropertyNames(t),i=0;i<a.length;i++){var o=a[i],s=Object.getOwnPropertyDescriptor(t,o);s&&s.configurable&&void 0===e[o]&&Object.defineProperty(e,o,s)}return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):a(e,t))}var r={position:{top:"100",left:"200"},draggable:!0,styles:{width:"800",height:"800"}},n=function(e){function a(t){i(this,a);var s=o(this,e.call(this));return s.options=t,s}return s(a,e),a.prototype.buildOn=function(e){this.map=e;for(var a=t.DomUtil.createEl("div","maptalks-Toc"),i=t.DomUtil.createEl("ul","maptalks-layerUl"),o="",s=this._getLayerIds(e),r=s.length-1;r>=0;r--){var n=void 0;1==s[r].visible?(n="checked",o=o+'<li class="maptalks-layerLi" id="'+s[r].id+'"><input class="maptalks-layerInput" id="'+s[r].id+'" type="checkbox"  checked="'+n+'"><p class="maptalks-layerName">'+s[r].id+"</p></li>"):o=o+'<li class="maptalks-layerLi" id="'+s[r].id+'"><input class="maptalks-layerInput" id="'+s[r].id+'" type="checkbox" ><p class="maptalks-layerName">'+s[r].id+"</p></li>"}return i.innerHTML=o,this._setstyle(a,this.options),a.appendChild(i),this._domToc=a,e.on("addlayer",this._addLayers,this),this._layerDomMousedown(this._domToc),this._registerDomEvent(),a},a.prototype._addLayers=function(e){for(var a=this.map,i="",o=this._getLayerIds(a),s=o.length-1;s>=0;s--){var r=void 0;1==o[s].visible?(r="checked",i=i+'<li class="maptalks-layerLi" id="'+o[s].id+'"><input class="maptalks-layerInput" id="'+o[s].id+'" type="checkbox"  checked="'+r+'"><p class="maptalks-layerName">'+o[s].id+"</p></li>"):i=i+'<li class="maptalks-layerLi" id="'+o[s].id+'"><input class="maptalks-layerInput" id="'+o[s].id+'" type="checkbox" ><p class="maptalks-layerName">'+o[s].id+"</p></li>"}var n=t.DomUtil.createEl("Ul","maptalks-layerNewUl");n.innerHTML=i;var l=document.getElementsByClassName("maptalks-Toc")[0].firstChild;console.log(l),document.getElementsByClassName("maptalks-Toc")[0].replaceChild(n,l)},a.prototype._getLayerIds=function(e){for(var t=[],a=e.getLayers(),i=0;i<a.length;i++){var o={};o.id=a[i].getId(),o.visible=a[i].isVisible(),o.zindex=a[i].getZIndex(),t.push(o)}var s={};return s.id=e.getBaseLayer().getId(),s.visible=e.getBaseLayer().isVisible(),s.zindex=e.getBaseLayer().getZIndex(),t.push(s),t=this._layerZindexSort(t,"zindex"),console.log(t),t},a.prototype._layerZindexSort=function(e,t){return e=e.sort(this._layerZindexCompare(t))},a.prototype._layerZindexCompare=function(e){return function(t,a){return t[e]-a[e]}},a.prototype._switchLayer=function(){this.map=this.getMap();var e=document.getElementsByClassName("maptalks-layerInput");if(e.length>0)for(var t=0;t<e.length;t++)e[t].onclick=function(e){var t=e.target.id;e.target.checked?this.map.getLayer(t)?this.map.getLayer(t).show():this.map.getBaseLayer().show():this.map.getLayer(t)?this.map.getLayer(t).hide():this.map.getBaseLayer().hide()}.bind(this);else alert("No Layers")},a.prototype._registerDomEvent=function(){this._domToc&&t.DomUtil.addDomEvent(this._domToc,"mouseover",this._switchLayer,this)},a.prototype._setstyle=function(e,t){for(var a in t.styles)e.style[a]=t.styles[a]},a.prototype._layerDomMousedown=function(e){for(var t=document.getElementsByTagName("maptalks-layerLi"),a=void 0,i=0;i<t.length;i++)t[i].onmousedown=function(e){a=e.target.id},t[i].onmouseup=function(t){var i=t.target.id,o=document.getElementById(a),s=document.getElementById(i);e.insertBefore(o,s)}},a}(t.control.Control);n.mergeOptions(r),e.Toc=n,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.Toc v0.1.2, requires maptalks@^0.16.0.")});